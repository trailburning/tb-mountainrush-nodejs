<!DOCTYPE html>
<html>
<head>
<% include ../partials/includes.ejs %>
<link href='/static-assets/css/photoswipe.css' rel='stylesheet' />
<link href='/static-assets/css/default-skin/default-skin-with-ig.css' rel='stylesheet' />
<% if (Campaign.CampaignTemplate != 'default') { %>
  <link href='/static-assets/css/<%= Campaign.CampaignTemplate %>/web_platform.css' rel='stylesheet' />
<% } %>
<link href="//ajax.googleapis.com/ajax/libs/jqueryui/1.8.1/themes/base/jquery-ui.css" rel="stylesheet" type="text/css"/>
<link href='/static-assets/css/campaign.css' rel='stylesheet' />
<% if (Campaign.CampaignTemplate != 'default') { %>
  <link href='/static-assets/css/<%= Campaign.CampaignTemplate %>/campaign.css' rel='stylesheet' />
<% } %>
<% include ../partials/analyticsFBPixel.ejs %>
</head>
<body>
<script>
var APP = 'CampaignApp';
var GAME_API_URL = '<%= Defs.MRAPIURL %>';
var GAME_FUNDRAISING = <%= Campaign.CampaignFundraising %>;
var HOST_URL = '<%= Defs.BaseHTTPSURL %>';
var CLIENT_ID = '<%= Campaign.ClientID %>';
var CAMPAIGN_ID = '<%= Campaign.CampaignID %>';
var CAMPAIGN_TEMPLATE = '<%= Campaign.CampaignTemplate %>';
var CAMPAIGN_JUICER_FEED = '<%= Campaign.CampaignJuicerFeed %>';
var CAMPAIGN_SEL_LANGUAGE = '<%= Campaign.SelLanguage["name"] %>';
var FUNDRAISING_PROVIDER_CAUSE_CODE = '<%= Defs.FundraisingProviderCauseCode %>';
</script>

<div class="container-fluid nopadding">
  <div id="page-view">
    <% if (Campaign.CampaignTemplate == 'default') { %>
      <% include ../partials/header.ejs %>
    <% } else { %>
      <%- include('../partials/' + Campaign.CampaignTemplate + '/header.ejs') %>
    <% } %>

    <% if (Campaign.CampaignTemplate == 'default') { %>
      <% include ../partials/campaign.ejs %>
    <% } else { %>
      <%- include('../partials/' + Campaign.CampaignTemplate + '/campaign.ejs') %>
    <% } %>

    <% if (Campaign.CampaignTemplate == 'default') { %>
      <% include ../partials/footer.ejs %>
    <% } else { %>
      <%- include('../partials/' + Campaign.CampaignTemplate + '/footer.ejs') %>
    <% } %>
  </div>
</div>


<div id="player-game-view"></div>
<div id="demo-video-view"></div>
<div id="challenge-vote-modal-view"></div>

<div id="mobileTest" class="visible-xs"></div>

<script type="text/template" id="challengeVoteModalViewTemplate">
  <div class="modal msg-overlay" tabindex="-1" role="dialog">
    <div class="modal-dialog" role="document">
      <div class="modal-content">
        <div class="modal-body">
          <div class="details">
            <div class="title">Thanks for voting!</div>
            <div class="description">
            Make sure you follow <strong>#climbforyourworld</strong> on social media to find out the next challenge!
            </div>
          </div>
        </div>
        <div class="big-close-btn"><i class="fa fa-times"></i></div>
      </div><!-- /.modal-content -->
    </div><!-- /.modal-dialog -->
  </div><!-- /.modal -->  
</script>

<script type="text/template" id="socialFeatureViewTemplate">
  <div class="community-feature-container-view">
    <h1>#ClimbForYourWorld</h1>
    {{ _.each(juicer.posts.items, function(post, index) { }}
      <div class="content">
        <div class="image"><a href="{{= post.full_url }}" target="_blank"><img src="{{= post.image }}"></a></div>
        <div class="text">
<!--          
          <div class="avatar"><img src="{{= post.poster_image }}"></div><div class="poster strong">{{= post.poster_name }}</div>
-->
          {{= post.message }}
          <div class="engagement">
          {{ if (post.likes >= 1) { }}
            <span class="likes"><i class="icon fa fa-heart"></i> {{= post.likes }}</span>
          {{ } }}

          {{ if (post.comments >= 1) { }}
            <i class="icon fa fa-comment"></i> {{= post.comments }}
          {{ } }}          
          </div>
        </div>
      </div>
    {{ }); }}
  </div>
</script>

<script type="text/template" id="campaignSummaryStickerViewTemplate">
  <div class="summary-total-raised">
    <div class="total-raised-sticker sm">
      <div class="total"><span class="currency_symbol">{{ if (fundraising_currency_symbol.length > 1) { }}<span class="fat-currency-symbol">{{= fundraising_currency_symbol }}</span>{{ } else { }}{{= fundraising_currency_symbol }}{{ } }}</span>{{= Math.round(total_fundraising_raised) }}</div>
      <div class="break"></div>
      <div class="title">Total Raised</div>
      <div class="title-sub">by climb for your world</div>
    </div>
  </div>
</script>

<script type="text/template" id="campaignSummaryViewTemplate">
  <div class="summary-total-raised">
    <div class="total-raised-sticker">
      <div class="total"><span class="currency_symbol">{{ if (fundraising_currency_symbol.length > 1) { }}<span class="fat-currency-symbol">{{= fundraising_currency_symbol }}</span>{{ } else { }}{{= fundraising_currency_symbol }}{{ } }}</span>{{= Math.round(total_fundraising_raised) }}</div>
      <div class="break"></div>
      <div class="title">Total Raised</div>
      <div class="title-sub">by climb for your world</div>
    </div>
  </div>

  <div class="summary-break"></div>

  <div class="summary-total-climbed">
    <div class="total">{{= total_ascent_formatted }}</div>
    <div class="title">Metres Climbed</div>
  </div>
</script>

<script type="text/template" id="leaderboardViewTemplate">
  {{ _.each(players, function(player, index) { }}
    <div class="leader">
      <div class="content">
        <div class="marker">
          {{ var strURL = '<%= Defs.BaseHTTPSURL %>/campaign/<%= Campaign.CampaignID %>' }}
          {{ if (player.gameID) { }}
            {{ strURL = '<%= Defs.BaseHTTPSURL %>/game/' + player.gameID + '/player/' + player.id }}
          {{ } }}
          <a href="{{= strURL }}"><div class="avatar">
          <% if (Campaign.CampaignTemplate == 'default') { %>
            <img src="<%= Defs.MRAPIURL %>imageproxy.php?url={{= player.avatar }}">
          <% } else { %>
            <img src="<%= Defs.MRAPIURL %>imageproxy.php?url={{= player.avatar }}&urlfallback=https://www.mountainrush.co.uk/static-assets/images/<%= Campaign.CampaignTemplate %>/avatar_unknown.jpg">
          <% } %>
          </div></a>
        </div>
        <div class="fundraise-detail">
          <div class="name">{{= player.firstname }} {{= player.lastname }}</div>
          <div class="climbed">Climbed {{= Math.round(player.ascent) }} m</div>
          <div class="amount-detail">Raised<span class="amount">
          {{ if (player.fundraising_currency_symbol) { }}{{ if (player.fundraising_currency_symbol.length > 1) { }}<span class="fat-currency-symbol">{{= player.fundraising_currency_symbol }}</span>{{ } else { }}{{= player.fundraising_currency_symbol }}{{ } }}{{ } else { }}${{ } }}{{= Math.round(player.fundraising_raised) }}</span>
          </div>
        </div>
      </div>
    </div>
  {{ }); }}
</script>

<script type="text/template" id="communityPhotosViewTemplate">
  {{ _.each(juicer.posts.items, function(post, index) { }}<div class="post">
    <div class="media">
      <a href="{{= post.full_url }}" target="_blank"><div class="image" style="background-image: url('{{= post.image }}')"></div>
      <div class="likes ago">
      {{ if (post.likes >= 1) { }}
        <i class="icon fa fa-heart"></i> {{= post.likes }}
      {{ } }}
      </div>
      </a>
    </div>
    <div class="details">
      <div class="text">
        <div class="name"><a href="{{= post.full_url }}" target="_blank">{{= post.poster_name }}</a></div>
        <div class="credit truncate"  data-truncate="62"> {{= post.message }}</div>
      </div>
    </div>
  </div>{{ }); }}
</script>

<script type="text/template" id="playerGameViewTemplate">
  <div class="modal msg-overlay" tabindex="-1" role="dialog">
    <div class="modal-dialog" role="document">
      <div class="modal-content">
        <div class="modal-body">
          {{ var activeGames = _.where(player.games, {game_state:'active'}) }}
          {{ var pendingGames = _.where(player.games, {game_state:'pending'}) }}

          {{ if (activeGames.length) { }}
            {{ var currGame = activeGames[0] }}

            {{ activityDescription = '' }}

            {{ if (currGame.type == 'Run') { }}
              {{ activityDescription = '<%= __('defs.activities.run') %>' }}
            {{ } else if (currGame.type == 'Ride') { }}
              {{ activityDescription = '<%= __('defs.activities.ride') %>' }}
            {{ } else if (currGame.type == 'Hike') { }}
              {{ activityDescription = '<%= __('defs.activities.hike') %>' }}
            {{ } }}

            <div class="details">
              <div class="title"><%= __('overlay.challenge.latest.title') %></div>
              <div class="description">
              {{= '<%= __('overlay.challenge.latest.description') %>'.replace('%s', player.firstname).replace('%s', '<strong>' + currGame.name + '</strong> <span class="lowercase">' + activityDescription + '</span>') }}
              </div>
            </div>

            <div class="action-fields">
              <div class="action-field"><a href="<%= Defs.BaseHTTPSURL %>/game/{{= currGame.game }}" class="btn mr-btn btn-primary"><%= __('overlay.challenge.yes') %></a></div>
              <div class="action-field"><span class="btn mr-btn" data-dismiss="modal"><%= __('overlay.challenge.no') %></span></div>
            </div>
          {{ } else if (pendingGames.length) { }}
            {{ var currGame = pendingGames[0] }}

            {{ activityDescription = '' }}

            {{ if (currGame.type == 'Run') { }}
              {{ activityDescription = '<%= __('defs.activities.run') %>' }}
            {{ } else if (currGame.type == 'Ride') { }}
              {{ activityDescription = '<%= __('defs.activities.ride') %>' }}
            {{ } else if (currGame.type == 'Hike') { }}
              {{ activityDescription = '<%= __('defs.activities.hike') %>' }}
            {{ } }}

            <div class="details">
              <div class="title"><%= __('overlay.challenge.upcoming.title') %></div>
              <div class="description">
              {{= '<%= __('overlay.challenge.upcoming.description') %>'.replace('%s', player.firstname).replace('%s', '<strong>' + currGame.name + '</strong> <span class="lowercase">' + activityDescription + '</span>') }}
              </div>
            </div>

            <div class="action-fields">
              <div class="action-field"><a href="<%= Defs.BaseHTTPSURL %>/game/{{= currGame.game }}" class="btn mr-btn btn-primary">Yes please</a></div>
              <div class="action-field"><span class="btn mr-btn" data-dismiss="modal">Maybe later</span></div>
            </div>
          {{ } }}
        </div>
      </div><!-- /.modal-content -->
    </div><!-- /.modal-dialog -->
  </div><!-- /.modal -->
</script>

</body>

<% include ../partials/analytics.ejs %>

<script data-main="/static-assets/js/main" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.5/require.min.js"></script>

<!-- Example of how to use Piste API -->
<script type="text/javascript">
if ( typeof Procedural === 'undefined' ) { Procedural = {}; }
</script>
</html>